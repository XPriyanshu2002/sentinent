<!-- <section class="page">
  <h2>Participants</h2>

  <form class="add-form" [formGroup]="form" (ngSubmit)="submit()">
    <input formControlName="name" placeholder="Name" required />
    <input formControlName="email" placeholder="Email" />
    <input formControlName="role" placeholder="Role" />
    <button type="submit" [disabled]="loading">Add</button>
  </form>

  <div class="list">
    <table>
      <thead><tr><th>Name</th><th>Email</th><th>Role</th><th>Created</th></tr></thead>
      <tbody>
        <tr *ngFor="let p of participants">
          <td>{{p.name}}</td>
          <td>{{p.email}}</td>
          <td>{{p.role}}</td>
          <td>{{p.createdAt | date:'short'}}</td>
        </tr>
      </tbody>
    </table>
  </div>
</section> -->


<section class="participants-page">
  <!-- Top row -->
  <div class="top-row">
    <div class="title-block">
      <h1>Participants</h1>
      <p class="muted">Manage participants, statuses and contact details</p>
    </div>

    <div class="actions">
      <button class="btn btn-ghost" (click)="onBulkAction()">Bulk actions</button>
      <button class="btn btn-primary" (click)="openAdd()">+ Add participant</button>
    </div>
  </div>

  <!-- Add form panel (inline) -->
  <div class="add-panel" *ngIf="showAddForm">
    <form [formGroup]="addForm" (ngSubmit)="submitAdd()" class="add-form-panel">
      <div class="row">
        <div class="col">
          <label>Participant Name *</label>
          <input formControlName="name" placeholder="Full name" />
        </div>

        <div class="col">
          <label>NDIS number</label>
          <input formControlName="ndis" placeholder="NDIS number" />
        </div>

        <div class="col">
          <label>Role</label>
          <select formControlName="role">
            <option *ngFor="let r of roleOptions" [value]="r">{{ r }}</option>
          </select>
        </div>
      </div>

      <div class="row actions-row">
        <div class="left"></div>
        <div class="right">
          <button type="button" class="btn btn-ghost" (click)="closeAdd()">Cancel</button>
          <button type="submit" class="btn btn-primary" [disabled]="submitting">
            {{ submitting ? 'Adding...' : 'Add participant' }}
          </button>
        </div>
      </div>
    </form>
  </div>

  <!-- KPI row (same as earlier) -->
  <div class="kpi-row">
    <div class="kpi">
      <div class="kpi-value">{{ participants?.length || 0 }}</div>
      <div class="kpi-label">Total Participants</div>
      <div class="kpi-sub">+12 this month</div>
    </div>
    <div class="kpi">
      <div class="kpi-value">$247k</div>
      <div class="kpi-label">Pipeline Value</div>
      <div class="kpi-sub">+12% growth</div>
    </div>
    <div class="kpi">
      <div class="kpi-value">247</div>
      <div class="kpi-label">Active Leads</div>
      <div class="kpi-sub">8 new this week</div>
    </div>
    <div class="kpi">
      <div class="kpi-value">68%</div>
      <div class="kpi-label">Conversion Rate</div>
      <div class="kpi-sub">+5% vs last month</div>
    </div>
  </div>

  <!-- Filters and search -->
  <!-- <div class="filters">
    <div class="search">
      <input [formControl]="searchControl" placeholder="Search contact" />
      <svg class="search-icon" viewBox="0 0 24 24">
        <path d="M21 21l-4.35-4.35M10.5 18A7.5 7.5 0 1 1 10.5 3a7.5 7.5 0 0 1 0 15z" stroke="currentColor"
          stroke-width="1.4" fill="none" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
    </div>

    <div class="filter-controls">
      <select [(ngModel)]="filterStatus" (change)="applyFilters()">
        <option value="">All status</option>
        <option *ngFor="let s of statusOptions" [value]="s">{{s}}</option>
      </select>

      <select [(ngModel)]="filterRole" (change)="applyFilters()">
        <option value="">All roles</option>
        <option *ngFor="let r of roleOptions" [value]="r">{{r}}</option>
      </select>

      <button class="btn btn-ghost" (click)="clearFilters()">Clear all</button>
    </div>
  </div> -->

  <div class="filters">
  <div class="search">
    <input [formControl]="searchControl" placeholder="Search contact" />
    <svg class="search-icon" viewBox="0 0 24 24">
      <path d="M21 21l-4.35-4.35M10.5 18A7.5 7.5 0 1 1 10.5 3a7.5 7.5 0 0 1 0 15z"
            stroke="currentColor" stroke-width="1.4" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </div>

  <div class="filter-controls">
    <!-- use reactive controls instead of ngModel -->
    <select [formControl]="filterStatusControl">
      <option value="">All status</option>
      <option *ngFor="let s of statusOptions" [value]="s">{{s}}</option>
    </select>

    <select [formControl]="filterRoleControl">
      <option value="">All roles</option>
      <option *ngFor="let r of roleOptions" [value]="r">{{r}}</option>
    </select>

    <button class="btn btn-ghost" (click)="clearFilters()">Clear all</button>
  </div>
</div>

  <!-- Table card -->
  <div class="table-card">
    <table class="table">
      <thead>
        <tr>
          <th class="col-checkbox"><input type="checkbox" /></th>
          <th>Name</th>
          <th>Contact</th>
          <th>NDIS number</th>
          <th>Status</th>
          <th>Service Type</th>
          <th>Last contacted</th>
          <th>Staff</th>
          <th class="col-actions"></th>
        </tr>
      </thead>

      <tbody>
        <!-- skeleton rows while loading -->
        <ng-container *ngIf="loading; else dataRows">
          <tr class="skeleton-row" *ngFor="let n of [1,2,3,4]">
            <td colspan="9">
              <div class="shimmer"></div>
            </td>
          </tr>
        </ng-container>

        <!-- actual data rows -->
        <ng-template #dataRows>
          <tr *ngFor="let p of pagedItems; let i = index" class="table-row" [class.alt]="i % 2 === 1">
            <td class="col-checkbox"><input type="checkbox" /></td>

            <td class="col-name">
              <div class="cell">
                <div class="avatar" [style.background]="avatarColor(p.name)">{{ initials(p.name) }}</div>
                <div class="meta">
                  <div class="name">{{ p.name }}</div>
                  <div class="muted small">{{ p.role || 'Participant' }}</div>
                </div>
              </div>
            </td>

            <td>
              <div class="muted small">{{ p.email }}</div>
              <div class="muted small">{{ p.phone || '(03) 9876 5432' }}</div>
            </td>

            <td>{{ p.ndis || p.id || 'â€”' }}</td>

            <td>
              <span class="badge" [ngClass]="statusClass(p.status)">{{ p.status || 'Active' }}</span>
            </td>

            <td>
              <div class="chips">
                <span class="chip" *ngFor="let t of p.tags || ['Disability care']">{{ t }}</span>
              </div>
            </td>

            <td>{{ p.createdAt | date:'MMM d, yyyy' }}</td>
            <td>{{ p.staff || 'Sarah Taylo' }}</td>

            <td class="col-actions">
              <button class="icon-btn" title="View" aria-label="View">
                <!-- eye / view icon -->
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12z" stroke="currentColor" stroke-width="1.2"
                    stroke-linecap="round" stroke-linejoin="round" />
                  <circle cx="12" cy="12" r="2.5" fill="currentColor" />
                </svg>
              </button>

              <button class="icon-btn" title="Edit" aria-label="Edit">
                <!-- pencil / edit icon -->
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                  <path d="M3 21l3-1 11-11 1-3-3 1L4 20z" stroke="currentColor" stroke-width="1.2"
                    stroke-linecap="round" stroke-linejoin="round" />
                </svg>
              </button>
            </td>

          </tr>
        </ng-template>
      </tbody>
    </table>

    <div class="table-footer">
      <button class="btn btn-ghost" [disabled]="page === 1" (click)="prevPage()">Previous</button>
      <div class="page-info">Page {{page}} of {{totalPages}}</div>
      <button class="btn btn-ghost" [disabled]="page === totalPages" (click)="nextPage()">Next</button>
    </div>
  </div>
</section>